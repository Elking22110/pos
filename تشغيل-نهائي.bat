@echo off
chcp 65001 >nul
echo ========================================
echo    ุชุดุบูู ูุธุงู ุฅุฏุงุฑุฉ ุงููุจูุนุงุช (ููุงุฆู)
echo ========================================
echo.

echo [1/5] ุชูุธูู ุดุงูู ููู cache...
if exist "%TEMP%\electron*" rmdir /s /q "%TEMP%\electron*" 2>nul
if exist "%LOCALAPPDATA%\electron*" rmdir /s /q "%LOCALAPPDATA%\electron*" 2>nul
if exist "%APPDATA%\electron*" rmdir /s /q "%APPDATA%\electron*" 2>nul
echo โ ุชู ุชูุธูู ุงูู cache

echo.
echo [2/5] ุงูุชุญูู ูู ูุฌูุฏ ุงูุชุทุจูู ุงููุจูู...
if not exist "dist\index.html" (
    echo โ๏ธ  ุงูุชุทุจูู ุบูุฑ ูุจูู. ุณูุชู ุงูุจูุงุก ุงูุขู...
    echo.
    call npm run build
    if %errorlevel% neq 0 (
        echo โ ูุดู ูู ุจูุงุก ุงูุชุทุจูู
        pause
        exit /b 1
    )
    echo โ ุชู ุจูุงุก ุงูุชุทุจูู ุจูุฌุงุญ
    echo.
) else (
    echo โ ุงูุชุทุจูู ุฌุงูุฒ ููุชุดุบูู
    echo.
)

echo [3/5] ุงูุชุญูู ูู ุงูุชุจุนูุงุช...
if not exist "node_modules" (
    echo โ๏ธ  ุงูุชุจุนูุงุช ุบูุฑ ูุซุจุชุฉ. ุณูุชู ุงูุชุซุจูุช ุงูุขู...
    call npm install
    if %errorlevel% neq 0 (
        echo โ ูุดู ูู ุชุซุจูุช ุงูุชุจุนูุงุช
        pause
        exit /b 1
    )
    echo โ ุชู ุชุซุจูุช ุงูุชุจุนูุงุช ุจูุฌุงุญ
    echo.
) else (
    echo โ ุงูุชุจุนูุงุช ุฌุงูุฒุฉ
    echo.
)

echo [4/5] ุฅุนุฏุงุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ...
set ELECTRON_DISABLE_SECURITY_WARNINGS=1
set ELECTRON_IS_DEV=0
set ELECTRON_DISABLE_GPU=0
echo โ ุชู ุฅุนุฏุงุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ

echo.
echo [5/5] ุชุดุบูู ุงูุชุทุจูู...
echo โ ุจุฏุก ุชุดุบูู ูุธุงู ุฅุฏุงุฑุฉ ุงููุจูุนุงุช...
echo.
echo ========================================
echo    ุงูุชุทุจูู ูุนูู ุงูุขู! ๐
echo ========================================
echo.
echo ููุงุญุธุงุช ูููุฉ:
echo - ุฅุฐุง ุธูุฑุช ูุงูุฐุฉ ูุงุฑุบุฉุ ุงูุชุธุฑ ููููุงู ุญุชู ูุชู ุชุญููู ุงููุญุชูู
echo - ููููู ุฅุบูุงู ูุฐู ุงููุงูุฐุฉ ูุฅููุงู ุงูุชุทุจูู
echo - ูู ุญุงูุฉ ูุฌูุฏ ูุดุงููุ ุฌุฑุจ ุฅุนุงุฏุฉ ุชุดุบูู ุงูููุจููุชุฑ
echo.

call npm run electron
if %errorlevel% neq 0 (
    echo โ ูุดู ูู ุชุดุบูู ุงูุชุทุจูู
    echo.
    echo ุฌุฑุจ ุงูุญููู ุงูุชุงููุฉ:
    echo 1. ุชุฃูุฏ ูู ุชุซุจูุช Node.js
    echo 2. ุงูุณุญ ูุฌูุฏ node_modules ูุฃุนุฏ ุงูุชุซุจูุช
    echo 3. ุชุญูู ูู ูุณุงุญุฉ ุงููุฑุต ุงููุชุงุญุฉ
    echo 4. ุฃุนุฏ ุชุดุบูู ุงูููุจููุชุฑ
    echo 5. ุชุดุบูู ููุฏูุฑ (Run as Administrator)
    echo.
    pause
    exit /b 1
)

echo.
echo ุชู ุฅุบูุงู ุงูุชุทุจูู ุจูุฌุงุญ
pause
